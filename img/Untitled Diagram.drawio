<mxfile host="app.diagrams.net" modified="2022-01-28T02:40:00.004Z" agent="5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.99 Safari/537.36" etag="7kplVeVHHWIxYttF6JCA" version="16.4.7" type="github">
  <diagram id="C5RBs43oDa-KdzZeNtuy" name="Page-1">
    <mxGraphModel dx="1773" dy="1682" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-0" />
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-1" parent="WIyWlLk6GJQsqaUBKTNV-0" />
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-1" value="" style="edgeStyle=orthogonalEdgeStyle;curved=0;rounded=1;sketch=1;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#46495D;strokeColor=#788AA3;fillColor=#B2C9AB;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="WIyWlLk6GJQsqaUBKTNV-3" target="-cFR_FY4Ac59gnSg9RBy-0">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-3" value="新增用户站内信" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;sketch=1;fillColor=#B2C9AB;strokeColor=#788AA3;fontColor=#46495D;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="160" y="-50" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-8" value="No" style="rounded=1;html=1;jettySize=auto;orthogonalLoop=1;fontSize=11;endArrow=block;endFill=0;endSize=8;strokeWidth=1;shadow=0;labelBackgroundColor=none;edgeStyle=orthogonalEdgeStyle;sketch=1;curved=1;strokeColor=#788AA3;fontColor=#46495D;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="WIyWlLk6GJQsqaUBKTNV-10" target="WIyWlLk6GJQsqaUBKTNV-11" edge="1">
          <mxGeometry x="0.3333" y="20" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-32" value="yes" style="edgeStyle=orthogonalEdgeStyle;curved=0;rounded=1;sketch=1;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#46495D;strokeColor=#788AA3;fillColor=#B2C9AB;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="WIyWlLk6GJQsqaUBKTNV-10" target="-cFR_FY4Ac59gnSg9RBy-31">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-10" value="r1(userId).len&lt;br&gt;&amp;gt;1000" style="rhombus;whiteSpace=wrap;html=1;shadow=0;fontFamily=Helvetica;fontSize=12;align=center;strokeWidth=1;spacing=6;spacingTop=-4;sketch=1;rounded=1;fillColor=#B2C9AB;strokeColor=#788AA3;fontColor=#46495D;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-40" y="500" width="100" height="80" as="geometry" />
        </mxCell>
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-11" value="结束" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;sketch=1;fillColor=#B2C9AB;strokeColor=#788AA3;fontColor=#46495D;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-50" y="610" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-0" value="" style="whiteSpace=wrap;html=1;fillColor=#B2C9AB;strokeColor=#788AA3;fontColor=#46495D;rounded=1;glass=0;strokeWidth=1;shadow=0;sketch=1;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-60" y="70" width="390" height="80" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-24" value="" style="edgeStyle=orthogonalEdgeStyle;curved=0;rounded=1;sketch=1;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#46495D;strokeColor=#788AA3;fillColor=#B2C9AB;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="-cFR_FY4Ac59gnSg9RBy-3" target="-cFR_FY4Ac59gnSg9RBy-23">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-3" value="新增站内信，并绑定新增站内信ID到redis中用户的站内信最新动态队列的关系中&lt;br&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;sketch=1;fontColor=#46495D;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-50" y="70" width="350" height="80" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-7" value="&lt;h1&gt;redis 动态队列维护(r1)&lt;/h1&gt;&lt;div&gt;维护用户-最新1000条消息ID 动态队列&lt;/div&gt;&lt;div&gt;使用数据结构：list&lt;/div&gt;&lt;div&gt;动态队列维护：leftpush、rightpop&lt;/div&gt;&lt;div&gt;消息已读处理：remove&lt;/div&gt;&lt;div&gt;key: userId -&amp;gt; values msgIds&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;sketch=1;fontColor=#46495D;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="250" y="-260" width="270" height="150" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-9" style="edgeStyle=orthogonalEdgeStyle;curved=0;rounded=1;sketch=1;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fontColor=#46495D;strokeColor=#788AA3;fillColor=#B2C9AB;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="-cFR_FY4Ac59gnSg9RBy-8" target="-cFR_FY4Ac59gnSg9RBy-7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-8" value="&lt;h1&gt;redis 维护用户队列（r2）&lt;/h1&gt;&lt;div&gt;维护接收站内信的用户队列&lt;/div&gt;&lt;div&gt;使用数据结构：set&lt;/div&gt;&lt;div&gt;用户接收站内信时，维护接收站内信的用户的队列&lt;/div&gt;&lt;div&gt;作用：用于每天执行数据备份时，清理维护的用户最新站内信关系动态队列&lt;/div&gt;&lt;div&gt;key: usermsgs -&amp;gt; value userId&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;sketch=1;fontColor=#46495D;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="570" y="-270" width="280" height="170" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-14" value="" style="edgeStyle=orthogonalEdgeStyle;curved=0;rounded=1;sketch=1;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#46495D;strokeColor=#788AA3;fillColor=#B2C9AB;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="-cFR_FY4Ac59gnSg9RBy-10" target="-cFR_FY4Ac59gnSg9RBy-13">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-10" value="消息已读处理" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;sketch=1;fillColor=#B2C9AB;strokeColor=#788AA3;fontColor=#46495D;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="580" y="-50" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-16" value="" style="edgeStyle=orthogonalEdgeStyle;curved=0;rounded=1;sketch=1;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#46495D;strokeColor=#788AA3;fillColor=#B2C9AB;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="-cFR_FY4Ac59gnSg9RBy-13" target="-cFR_FY4Ac59gnSg9RBy-15">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-20" value="否" style="edgeLabel;html=1;align=right;verticalAlign=middle;resizable=0;points=[];fontColor=#46495D;" vertex="1" connectable="0" parent="-cFR_FY4Ac59gnSg9RBy-16">
          <mxGeometry x="-0.1333" y="4" relative="1" as="geometry">
            <mxPoint x="16" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-18" value="" style="edgeStyle=orthogonalEdgeStyle;curved=0;rounded=1;sketch=1;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#46495D;strokeColor=#788AA3;fillColor=#B2C9AB;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="-cFR_FY4Ac59gnSg9RBy-13" target="-cFR_FY4Ac59gnSg9RBy-17">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-19" value="是" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#46495D;" vertex="1" connectable="0" parent="-cFR_FY4Ac59gnSg9RBy-18">
          <mxGeometry x="-0.2571" y="4" relative="1" as="geometry">
            <mxPoint y="-11" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-13" value="消息批量已读" style="rhombus;whiteSpace=wrap;html=1;fillColor=#B2C9AB;strokeColor=#788AA3;fontColor=#46495D;rounded=1;glass=0;strokeWidth=1;shadow=0;sketch=1;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="590" y="40" width="100" height="90" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-34" value="" style="edgeStyle=orthogonalEdgeStyle;curved=0;rounded=1;sketch=1;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#46495D;strokeColor=#788AA3;fillColor=#B2C9AB;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="-cFR_FY4Ac59gnSg9RBy-15" target="-cFR_FY4Ac59gnSg9RBy-33">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-15" value="标记某条消息已读 OR&lt;br&gt;标记某条消息已被处理&lt;br&gt;r3.get(msgId)--&amp;gt;msgId:userId&lt;br&gt;r1(userId).remove(msgId)&lt;br&gt;r3.del(msgId)" style="whiteSpace=wrap;html=1;fillColor=#B2C9AB;strokeColor=#788AA3;fontColor=#46495D;rounded=1;glass=0;strokeWidth=1;shadow=0;sketch=1;align=left;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="552.5" y="180" width="175" height="110" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-35" style="edgeStyle=orthogonalEdgeStyle;curved=0;rounded=1;sketch=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontColor=#46495D;strokeColor=#788AA3;fillColor=#B2C9AB;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="-cFR_FY4Ac59gnSg9RBy-17" target="-cFR_FY4Ac59gnSg9RBy-33">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-17" value="r3.mget(msgIds) --&amp;gt; (msgId:userId) s&lt;br&gt;iter 循环处理：&lt;br&gt;分解msgid:userId&amp;nbsp;&lt;br&gt;r1(userId).remove(msgId)&lt;br&gt;&lt;br&gt;r3.del(msgIds)&lt;br&gt;&lt;div&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;fillColor=#B2C9AB;strokeColor=#788AA3;fontColor=#46495D;rounded=1;glass=0;strokeWidth=1;shadow=0;sketch=1;align=left;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="810" y="27.5" width="210" height="115" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-22" value="&lt;h1&gt;redis 动态队列维护(r3)&lt;/h1&gt;&lt;div&gt;维护msgId-userId 数据信息&lt;/div&gt;&lt;div&gt;&lt;span&gt;使用数据结构：hashmap&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;动态队列维护：put / putAll&lt;/div&gt;&lt;div&gt;&lt;span&gt;消息已读处理：remove&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;key:msgId -&amp;gt; value: msgId:userId&lt;/span&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;sketch=1;fontColor=#46495D;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-20" y="-260" width="260" height="130" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-26" value="" style="edgeStyle=orthogonalEdgeStyle;curved=0;rounded=1;sketch=1;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#46495D;strokeColor=#788AA3;fillColor=#B2C9AB;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="-cFR_FY4Ac59gnSg9RBy-23" target="-cFR_FY4Ac59gnSg9RBy-25">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-27" value="yes" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#46495D;" vertex="1" connectable="0" parent="-cFR_FY4Ac59gnSg9RBy-26">
          <mxGeometry x="0.0222" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-29" value="" style="edgeStyle=orthogonalEdgeStyle;curved=0;rounded=1;sketch=1;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#46495D;strokeColor=#788AA3;fillColor=#B2C9AB;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="-cFR_FY4Ac59gnSg9RBy-23" target="-cFR_FY4Ac59gnSg9RBy-28">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-23" value="重要等级，&lt;br&gt;是否为弹框消息" style="rhombus;whiteSpace=wrap;html=1;rounded=0;sketch=1;fontColor=#46495D;strokeColor=#788AA3;fillColor=#B2C9AB;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-40" y="225" width="145" height="80" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-30" style="edgeStyle=orthogonalEdgeStyle;curved=0;rounded=1;sketch=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontColor=#46495D;strokeColor=#788AA3;fillColor=#B2C9AB;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="-cFR_FY4Ac59gnSg9RBy-25" target="WIyWlLk6GJQsqaUBKTNV-10">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-25" value="&lt;span&gt;r2.add(userId)&lt;/span&gt;&lt;br&gt;&lt;span&gt;r3.put(msgId,msgId:userId)&lt;br&gt;&lt;/span&gt;r1(userId).leftpush" style="whiteSpace=wrap;html=1;fillColor=#B2C9AB;strokeColor=#788AA3;fontColor=#46495D;rounded=0;sketch=1;align=left;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-51.25" y="350" width="167.5" height="85" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-28" value="不做缓存处理" style="whiteSpace=wrap;html=1;fillColor=#B2C9AB;strokeColor=#788AA3;fontColor=#46495D;rounded=0;sketch=1;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="197.5" y="235" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-31" value="r1(userId).rightpop" style="whiteSpace=wrap;html=1;fillColor=#B2C9AB;strokeColor=#788AA3;fontColor=#46495D;shadow=0;strokeWidth=1;spacing=6;spacingTop=-4;sketch=1;rounded=1;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="160" y="510" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-46" value="" style="edgeStyle=orthogonalEdgeStyle;curved=0;rounded=1;sketch=1;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#46495D;strokeColor=#788AA3;fillColor=#B2C9AB;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="-cFR_FY4Ac59gnSg9RBy-33" target="-cFR_FY4Ac59gnSg9RBy-45">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-47" value="yes" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#46495D;" vertex="1" connectable="0" parent="-cFR_FY4Ac59gnSg9RBy-46">
          <mxGeometry x="-0.1429" y="3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-49" value="" style="edgeStyle=orthogonalEdgeStyle;curved=0;rounded=1;sketch=1;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#46495D;strokeColor=#788AA3;fillColor=#B2C9AB;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="-cFR_FY4Ac59gnSg9RBy-33" target="-cFR_FY4Ac59gnSg9RBy-48">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-50" value="no" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#46495D;" vertex="1" connectable="0" parent="-cFR_FY4Ac59gnSg9RBy-49">
          <mxGeometry x="-0.3" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-33" value="r1(userId).len &amp;lt;100 &amp;amp;&amp;amp;&lt;br&gt;&amp;nbsp;! r0.contains(userId) &amp;amp;&amp;amp;&lt;br&gt;&amp;nbsp;count(userId)-&amp;gt;msgs &amp;gt;r1(userId).len" style="rhombus;whiteSpace=wrap;html=1;align=center;fillColor=#B2C9AB;strokeColor=#788AA3;fontColor=#46495D;rounded=1;glass=0;strokeWidth=1;shadow=0;sketch=1;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="790" y="370" width="240" height="180" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-36" value="&lt;h1&gt;redis 缓存信息补充（r0）&lt;/h1&gt;&lt;div&gt;数据结构：set&lt;/div&gt;&lt;div&gt;当r1 队列中，用户数据不足100，并且统计可弹框数据超过当前队列中的数据时，将该用户ID放入该队列中，由定时器 定时处理该队列中的用户数据，将查出来的数据添加到r1 队列右侧,定时器1h 执行一次&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;sketch=1;fontColor=#46495D;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="870" y="-270" width="280" height="170" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-52" value="" style="edgeStyle=orthogonalEdgeStyle;curved=0;rounded=1;sketch=1;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#46495D;strokeColor=#788AA3;fillColor=#B2C9AB;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="-cFR_FY4Ac59gnSg9RBy-45" target="-cFR_FY4Ac59gnSg9RBy-51">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-45" value="r0.add(userId)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#B2C9AB;strokeColor=#788AA3;fontColor=#46495D;glass=0;strokeWidth=1;shadow=0;sketch=1;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="850" y="690" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-48" value="表示补充数据的任务已在队列中/ 用户未读、可弹出的消息已经没有了，直接返回" style="whiteSpace=wrap;html=1;fillColor=#B2C9AB;strokeColor=#788AA3;fontColor=#46495D;rounded=1;glass=0;strokeWidth=1;shadow=0;sketch=1;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="1170" y="430" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-60" value="" style="edgeStyle=orthogonalEdgeStyle;curved=0;rounded=1;sketch=1;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#46495D;strokeColor=#788AA3;fillColor=#B2C9AB;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="-cFR_FY4Ac59gnSg9RBy-51" target="-cFR_FY4Ac59gnSg9RBy-59">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-51" value="定时任务处理队列中的用户数据，用于用户消息数据索引补充" style="whiteSpace=wrap;html=1;fillColor=#B2C9AB;strokeColor=#788AA3;fontColor=#46495D;rounded=1;glass=0;strokeWidth=1;shadow=0;sketch=1;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="1050" y="690" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-57" value="" style="edgeStyle=orthogonalEdgeStyle;curved=0;rounded=1;sketch=1;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#46495D;strokeColor=#788AA3;fillColor=#B2C9AB;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="-cFR_FY4Ac59gnSg9RBy-53" target="-cFR_FY4Ac59gnSg9RBy-56">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-53" value="组消息关闭" style="whiteSpace=wrap;html=1;rounded=0;sketch=1;fontColor=#46495D;strokeColor=#788AA3;fillColor=#B2C9AB;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="1130" y="-60" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-58" style="edgeStyle=orthogonalEdgeStyle;curved=0;rounded=1;sketch=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontColor=#46495D;strokeColor=#788AA3;fillColor=#B2C9AB;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="-cFR_FY4Ac59gnSg9RBy-56" target="-cFR_FY4Ac59gnSg9RBy-17">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-56" value="通过组ID查询改组对应的msgIds" style="whiteSpace=wrap;html=1;fillColor=#B2C9AB;strokeColor=#788AA3;fontColor=#46495D;rounded=0;sketch=1;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="1130" y="55" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-59" value="从任务队列中弹出一个用户ID，查询该用户最新可弹窗300条消息，执行&lt;br&gt;r1.len &amp;lt;150 -&amp;gt;&lt;br&gt;r1(userid).rightpush(msgIds)&lt;br&gt;r3.putall(msgIds,msgId:userId)&lt;br&gt;r0.del(userId)&lt;br&gt;&lt;br&gt;else&amp;nbsp;&lt;br&gt;r0.del(userId)" style="whiteSpace=wrap;html=1;fillColor=#B2C9AB;strokeColor=#788AA3;fontColor=#46495D;rounded=1;glass=0;strokeWidth=1;shadow=0;sketch=1;align=left;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="1020" y="820" width="320" height="150" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-74" value="" style="edgeStyle=orthogonalEdgeStyle;curved=0;rounded=1;sketch=1;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#46495D;strokeColor=#788AA3;fillColor=#B2C9AB;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="-cFR_FY4Ac59gnSg9RBy-61" target="-cFR_FY4Ac59gnSg9RBy-73">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-61" value="数据查询" style="whiteSpace=wrap;html=1;rounded=0;sketch=1;fontColor=#46495D;strokeColor=#788AA3;fillColor=#B2C9AB;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-285" y="570" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-64" value="msgIds -&amp;gt; 查询userwebmsg表，获取用户最新100条消息，过滤限制一条模版消息，location消息。。。" style="whiteSpace=wrap;html=1;rounded=0;sketch=1;fontColor=#46495D;strokeColor=#788AA3;fillColor=#B2C9AB;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-318.75" y="1050" width="187.5" height="110" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-68" value="" style="edgeStyle=orthogonalEdgeStyle;curved=0;rounded=1;sketch=1;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#46495D;strokeColor=#788AA3;fillColor=#B2C9AB;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="-cFR_FY4Ac59gnSg9RBy-66" target="-cFR_FY4Ac59gnSg9RBy-67">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-66" value="数据备份" style="whiteSpace=wrap;html=1;rounded=0;sketch=1;fontColor=#46495D;strokeColor=#788AA3;fillColor=#B2C9AB;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="340" y="740" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-72" value="" style="edgeStyle=orthogonalEdgeStyle;curved=0;rounded=1;sketch=1;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#46495D;strokeColor=#788AA3;fillColor=#B2C9AB;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="-cFR_FY4Ac59gnSg9RBy-67" target="-cFR_FY4Ac59gnSg9RBy-71">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-67" value="每天凌晨3点清空数据，执行数据备份逻辑" style="whiteSpace=wrap;html=1;fillColor=#B2C9AB;strokeColor=#788AA3;fontColor=#46495D;rounded=0;sketch=1;align=left;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="330" y="850" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-71" value="数据库数据备份，结束之后通过r2 清空 r1队列，然后清空 r3 队列，最后清空 r0 队列" style="whiteSpace=wrap;html=1;align=left;fillColor=#B2C9AB;strokeColor=#788AA3;fontColor=#46495D;rounded=0;sketch=1;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="315" y="980" width="170" height="90" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-76" value="" style="edgeStyle=orthogonalEdgeStyle;curved=0;rounded=1;sketch=1;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#46495D;strokeColor=#788AA3;fillColor=#B2C9AB;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="-cFR_FY4Ac59gnSg9RBy-73" target="-cFR_FY4Ac59gnSg9RBy-75">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-77" value="yes" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#46495D;" vertex="1" connectable="0" parent="-cFR_FY4Ac59gnSg9RBy-76">
          <mxGeometry x="0.08" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-79" value="" style="edgeStyle=orthogonalEdgeStyle;curved=0;rounded=1;sketch=1;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#46495D;strokeColor=#788AA3;fillColor=#B2C9AB;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="-cFR_FY4Ac59gnSg9RBy-73" target="-cFR_FY4Ac59gnSg9RBy-78">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-80" value="no" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#46495D;" vertex="1" connectable="0" parent="-cFR_FY4Ac59gnSg9RBy-79">
          <mxGeometry x="0.2741" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-73" value="r2(userId).contains" style="rhombus;whiteSpace=wrap;html=1;fillColor=#B2C9AB;strokeColor=#788AA3;fontColor=#46495D;rounded=0;sketch=1;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-300" y="700" width="150" height="110" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-81" style="edgeStyle=orthogonalEdgeStyle;curved=0;rounded=1;sketch=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontColor=#46495D;strokeColor=#788AA3;fillColor=#B2C9AB;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="-cFR_FY4Ac59gnSg9RBy-75" target="-cFR_FY4Ac59gnSg9RBy-64">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-75" value="&lt;span&gt;用户ID，r1(userId).range(0,100)&lt;/span&gt;" style="whiteSpace=wrap;html=1;fillColor=#B2C9AB;strokeColor=#788AA3;fontColor=#46495D;rounded=0;sketch=1;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-297.5" y="890" width="145" height="80" as="geometry" />
        </mxCell>
        <mxCell id="-cFR_FY4Ac59gnSg9RBy-78" value="&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;查询数据库，获取最新200 条数据，将对应数据存储在缓存队列中,r2.add(userId)&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;r1.add(userId,msgIds)&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;r3.addall(msgId,msgId:userId)&lt;/span&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;fillColor=#B2C9AB;strokeColor=#788AA3;fontColor=#46495D;rounded=0;sketch=1;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="-600" y="700" width="195" height="110" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
